

@{
    ViewData["Title"] = "Admin Panel - Anasayfa";
    Layout = "_Layout";
}

<div class="container-fluid">
    <div class="row flex-nowrap">
        
        <div class="col-auto col-md-3 col-xl-2 px-sm-2 px-0 bg-light shadow-sm border-end min-vh-100">
            <div class="d-flex flex-column align-items-center align-items-sm-start px-3 pt-3">
                
                    <span class="fs-5 fw-semibold d-none d-sm-inline text-secondary">Admin Panel</span>
                
                <ul class="nav nav-pills flex-column mb-sm-auto mb-0 align-items-center align-items-sm-start mt-4 w-100">
                    <li class="nav-item w-100">
                        <a href="javascript:void(0);" onclick="loadPartialView('/Category/CategoryList')" class="nav-link text-dark px-2">
                            <i class="bi bi-tags-fill me-2"></i>
                            <span class="d-none d-sm-inline">Categories</span>
                        </a>
                    </li>
                    <li class="nav-item w-100">
                        <a href="javascript:void(0);" onclick="loadPartialView('/AppUser/AppUserList')" class="nav-link text-dark px-2">
                            <i class="bi bi-people-fill me-2"></i>
                            <span class="d-none d-sm-inline">Users</span>
                        </a>
                    </li>
                    <li class="nav-item w-100">
                        <a href="javascript:void(0);" onclick="loadPartialView('/Admin/Admin/ArticleListBasic')" class="nav-link text-dark px-2">
                            <i class="bi bi-journal-text me-2"></i>
                            <span class="d-none d-sm-inline">Articles</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

       
        <div class="col py-4" id="main-content">
            
            <h3 class="mb-4">Welcome!</h3>
        </div>
    </div>
</div>
<div class="modal fade" id="deleteCategoryModal" tabindex="-1" aria-labelledby="deleteCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="deleteCategoryForm" asp-action="DeleteCategory" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteCategoryModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete category <strong id="deleteCategoryName"></strong>?</p>
                    <input type="hidden" name="Id" id="deleteCategoryId" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteArticleModal" tabindex="-1" aria-labelledby="deleteArticleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="deleteArticleForm" asp-area="" asp-controller="Article" asp-action="DeleteArticle" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteArticleModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete article?</p>
                    <input type="hidden" name="Id" id="deleteArticleId" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editCategoryModal" tabindex="-1" aria-labelledby="editCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="editCategoryForm" asp-action="UpdateCategory" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="editCategoryModalLabel">Edit Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="Id" id="editCategoryId" />
                    <div class="mb-3">
                        <label for="editCategoryName" class="form-label">Category Name</label>
                        <input type="text" class="form-control" name="Name" id="editCategoryName" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="createCategoryModal" tabindex="-1" aria-labelledby="createCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="createCategoryForm" asp-action="CreateCategory" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="createCategoryModalLabel">Add New Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="createCategoryName" class="form-label">Category Name</label>
                        <input type="text" class="form-control" name="Name" id="createCategoryName" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="deleteUserForm"  method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteUserModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete user <strong id="deleteUserName"></strong>?</p>
                    <input type="hidden" name="Id" id="deleteUserId" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog">

        <div class="modal-content shadow">
            <form id="editUserForm" method="post" enctype="multipart/form-data">
                <div class="modal-header">

                    <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="Id"  id="editUserId" />
                    <div class="mb-3">
                        <label for="UserName" class="form-label">UserName</label>
                        <input type="text" class="form-control" id="editUserName" name="UserName"  required />
                    </div>
                    <div class="mb-3">
                        <label for="Email" class="form-label">Email</label>
                        <input type="email" class="form-control" name="Email" id="editUserEmail"  required />
                    </div>
                    <div class="mb-3">
                        <label for="AboutMe" class="form-label">About Me</label>
                        <textarea class="form-control" name="AboutMe" id="editUserAboutMe" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="Image" class="form-label">Profile Image</label>
                        <input type="file" class="form-control" name="image" id="editUserImage" accept="image/*" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="assignRoleModal" tabindex="-1" aria-labelledby="assignRoleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="assignRoleForm" method="post" action="/AppUser/AssignRole">
                <div class="modal-header">
                    <h5 class="modal-title" id="assignRoleModalLabel">Set Role</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="userIdInput" name="userId" /> 
                    <div class="form-group">
                        <label for="roleSelect">Select Role:</label>
                        <select id="roleSelect" name="role" class="form-control">
                            
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Set</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            var loadPartial = '@ViewBag.LoadPartial';
            if (loadPartial) {
                loadPartialView(loadPartial);
            }
        });

        function loadPartialView(url) {
            $.ajax({
                url: url,
                type: 'GET',
                success: function (html) {
                    $('#main-content').html(html);
                },
                error: function () {
                    $('#main-content').html('<p>Failed to load.</p>');
                }
            });
        }
        
        $(document).on('click', '.editUserBtn', function () {
            var userId = $(this).data('id');
            var userName = $(this).data('username');
            var email = $(this).data('email');
            var aboutme = $(this).data('aboutme');
            var imageurl = $(this).data('imageurl');

            $('#editUserId').val(userId);
            $('#editUserName').val(userName);
            $('#editUserEmail').val(email);
            $('#editUserAboutMe').val(aboutme);
            $('#editUserImage').val(imageurl);

        });

        $(document).on('click', '.deleteArticleBtn', function () {
            var articleId = $(this).data('id');

            $('#deleteArticleId').val(articleId);
           
        });

        $(document).on('click', '.deleteUserBtn', function () {
            var userId = $(this).data('id');

            $('#deleteUserId').val(userId);

        });

        
        $(document).on('click', '.editCategoryBtn', function () {
            var categoryId = $(this).data('id');
            var categoryName = $(this).data('name');

            $('#editCategoryId').val(categoryId);
            $('#editCategoryName').val(categoryName);
        });

        
        $(document).on('click', '.deleteCategoryBtn', function () {
            var categoryId = $(this).data('id');
            var categoryName = $(this).data('name');

            $('#deleteCategoryId').val(categoryId);
            $('#deleteCategoryName').text(categoryName);
        });

        
        $('#deleteCategoryForm').submit(function (e) {
            e.preventDefault();
            var categoryId = $('#deleteCategoryId').val();

            $.ajax({
                url: '/Category/DeleteCategory',
                type: 'POST',
                data: { id: categoryId },
                success: function () {
                    loadPartialView('/Category/CategoryList');
                    $('#deleteCategoryModal').modal('hide');
                },
                error: function () {
                    alert('Failed to delete!');
                }
            });
        });

        $('#deleteArticleForm').submit(function (e) {
            e.preventDefault();
            var articleId = $('#deleteArticleId').val();

            $.ajax({
                url: '/Article/DeleteArticle',
                type: 'POST',
                data: { id: articleId },
                success: function () {
                    loadPartialView('/Admin/Admin/ArticleListBasic');
                    $('#deleteArticleModal').modal('hide');
                },
                error: function () {
                    alert('Failed to delete!');
                }
            });
        });

      
        $('#editCategoryForm').submit(function (e) {
            e.preventDefault();
            var categoryId = $('#editCategoryId').val();
            var categoryName = $('#editCategoryName').val();

            $.ajax({
                url: '/Category/UpdateCategory',
                type: 'POST',
                data: {
                    Id: categoryId,
                    Name: categoryName
                },
                success: function () {
                    loadPartialView('/Category/CategoryList');
                    $('#editCategoryModal').modal('hide');
                },
                error: function () {
                    alert('An error occurred while updating');
                }
            });
        });

                $('#createCategoryForm').submit(function (e) {
            e.preventDefault();
            var categoryName = $('#createCategoryName').val();

            $.ajax({
                url: '/Category/CreateCategory',
                type: 'POST',
                data: {
                    Name: categoryName
                },
                success: function () {
                    loadPartialView('/Category/CategoryList'); 
                    $('#createCategoryModal').modal('hide');  
                    $('#createCategoryForm')[0].reset();     
                },
                error: function () {
                    alert('Something went wrong');
                }
            });
        });

                   $('#editUserForm').submit(function (e) {
            e.preventDefault();

            var form = $('#editUserForm')[0];
            var formData = new FormData(form);

            $.ajax({
                url: '/AppUser/UpdateUser',
                type: 'POST',
                data: formData,
                processData: false, 
                contentType: false, 
                success: function () {
                    $('#editProfileModal').modal('hide');
                    loadPartialView('/AppUser/AppUserList');
                },
                error: function () {
                    alert('Failed to update user');
                }
            });
        });

                $(document).on('click', '.assignUserRoleBtn', function () {
            var userId = $(this).data('id');
            var currentRole = $(this).data('role');
           
            $.ajax({
                url: '/AppUser/GetRolesForAssign', 
                type: 'GET',
                success: function (data) {
                    
                    $('#roleSelect').empty();

                   
                    data.forEach(function(role) {
                        if(currentRole!=role){
                            $('#roleSelect').append('<option value="' + role + '">' + role + '</option>');
                        }else{
                            $('#roleSelect').append('<option value="' + role + '" selected>' + role + '</option>');
                        }
                        
                    });

                    
                    $('#userIdInput').val(userId);

                    
                    $('#assignRoleModal').modal('show');
                },
                error: function () {
                    alert("Failed");
                }
            });
        });
                       $('#assignRoleForm').submit(function (e) {
            e.preventDefault(); 

            var userId = $('#userIdInput').val(); 
            var role = $('#roleSelect').val(); 

            $.ajax({
                url: '/AppUser/AssignRole',  
                type: 'POST',
                data: {
                    userId: userId,
                    role: role
                },
                success: function () {
                    
                     loadPartialView('/AppUser/AppUserList');

                    
                    $('#assignRoleModal').modal('hide');
                    
                },
                error: function () {
                    alert("An error occurred while setting role.");
                }
            });
        });

        $('#deleteUserForm').on('submit', function (e) {
            e.preventDefault();
            var userId = $('#deleteUserId').val();
            

            $.ajax({
                url: '/AppUser/deleteUser',
                type: 'POST',
                data: {id : userId},
                success: function (response) {
                    
                    loadPartialView('/AppUser/AppUserList');
                    $('#deleteUserModal').modal('hide');
                },
                error: function () {
                    alert('An error occurred while deleting the user.');
                }
            });
        });

    </script>

}
